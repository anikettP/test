
# This workflow demonstrates a multi-platform matrix build
# that generates and uploads unique artifacts for each job.

name: CI Matrix Build

# Triggers the workflow on push or pull request events for the main branch
# Also allows for manual triggering from the Actions tab (workflow_dispatch)
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    # This job will run on the OS specified in the matrix
    runs-on: ${{ matrix.os }}

    # Define the build matrix
    strategy:
      # Ensures all jobs run, even if one fails
      fail-fast: false
      matrix:
        # 1st dimension: Operating System (3 variants)
        os: [ubuntu-latest, macos-latest, windows-latest]
        # 2nd dimension: Python Version (3 variants)
        python-version: ['3.9', '3.10', '3.11']
        # This creates a total of 3 * 3 = 9 parallel jobs

    steps:
      # 1. Check out the repository code
      - name: Check out code
        uses: actions/checkout@v4

      # 2. Set up the specific Python version for this matrix job
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      # 3. This step includes the required identifier "matrix-bf6da23"
      - name: matrix-bf6da23
        run: |
          echo "Starting build for variant:"
          echo "OS: ${{ matrix.os }}"
          echo "Python: ${{ matrix.python-version }}"

      # 4. Generate a unique, non-empty build artifact for this job
      - name: Generate build artifact
        run: |
          echo "This is the build output for OS: ${{ matrix.os }}, Python: ${{ matrix.python-version }}" > build_output.txt
          echo "Python version check: $(python --version)" >> build_output.txt
        # Use 'bash' shell for consistent behavior across all operating systems
        shell: bash

      # 5. Upload the generated artifact using actions/upload-artifact@v4
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          # Artifact name includes the required prefix and unique variant info
          name: build-bf6da23-${{ matrix.os }}-py${{ matrix.python-version }}
          # Path to the file to be uploaded
          path: build_output.txt
